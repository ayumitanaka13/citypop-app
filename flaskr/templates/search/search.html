{% from "/_formhelpers.html" import render_field %}
{% extends "/base.html" %}
{% block content %}

<div class="base-style">
    {% block header %}
    {{ super() }}
    {% endblock %}
    <div class="bg-style" style="background-image: linear-gradient(135deg, rgba(255, 147, 205, 0.3), rgba(61, 186, 244, 0.3)), url(/static/image/neon5.jpeg)">
        <div class="w-4/5 xl:w-1/2 box">
            <h1 class="subtitle">Search</h1>

            <div class="white-style">
                <div class="w-full">
                    <form method="POST" class="w-full px-6 sm:px-8 md:px-16">
                        {{form.csrf_token}}
                        <div class="flex flex-wrap md:flex-nowrap justify-center">
                            <h5 class="w-full pr-0 md:pr-2 lg:pr-4">
                                {{render_field(form.keyword, class="w-full text-lg sm:text-xl text-gray-400 rounded-full focus:outline-none py-1 sm:py-2 px-4")}}
                            </h5>
                            <h5 class="mt-4 md:mt-0">
                                {{form.submit(class="btn-blue")}}
                            </h5>
                        </div>
                    </form>
                    <div class="flex flex-wrap w-full content-around justify-around space-x-1 mt-6 lg:mt-12">
                    {% if not form.keyword.data %}
                        <h5>Let's find your favs!</h5>
                    {% else %}
                        {% set isMatched = {'isMatched':False} %}

                        {% for album in albums %}
                        {% if form.keyword.data.lower() in album.name.lower() or form.keyword.data.lower() in album.title.lower() %}
                        <div class="w-1/5 my-4">
                            <a href="{{ url_for('history.history', _anchor=album.name) }}">
                                <img src="{{ url_for('static', filename=album.album_picture_path) }}" class="transform duration-300 ease-linear hover:scale-105 shadow-lg">
                            </a>
                            <h5 class="mt-4">{{ album.name }}</h5>
                            <h5 class="mt-2">{{ album.title }}</h5>
                        </div>
                        {% if isMatched.update({'isMatched':True}) %}{% endif %}
                        {% endif %}
                        {% endfor %}

                        {% for artist in artists %}
                        {% if form.keyword.data.lower() in artist.name.lower() or form.keyword.data.lower() in artist.title.lower() %}
                        <div class="w-1/5 my-4">
                            <a href="{{ url_for('artist.artist', _anchor=artist.name) }}">
                                <img src="{{ url_for('static', filename=artist.song_picture_path) }}" class="transform duration-300 ease-linear hover:scale-105 shadow-lg">
                            </a>
                            <h5 class="mt-4">{{ artist.name }}</h5>
                            <h5 class="mt-2">{{ artist.title }}</h5>
                        </div>
                        {% if isMatched.update({'isMatched':True}) %}{% endif %}
                        {% endif %}
                        {% endfor %}

                        {% if not isMatched.isMatched %}
                        <h5>We couldn't find a match for "{{ form.keyword.data }}". Please try another Search.</h5>
                        {% endif %}
                    {% endif %}
                    </div>
                </div>    
            </div>
        </div>
    </div>
</div>

{% endblock %}