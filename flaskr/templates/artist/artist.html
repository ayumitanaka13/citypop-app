{% from "/_formhelpers.html" import render_field %}
{% extends "/base.html" %}
{% block content %}

<header class="px-8 md:px-12 xl:px-20" id="top">
    <nav class="w-full flex flex-wrap items-center justify-between bg-transparent lg:text-lg pt-4 lg:pt-6 box">
        <!-- search -->
        <ul class="text-lg md:text-xl lg:flex">
            <li>
                <a class="inline-block hover:opacity-75" href="{{ url_for('search.search') }}"><i class="fas fa-search mr-2"></i>Search</a>
            </li>
        </ul>            
        <!-- toggle -->
        <div class="block lg:hidden">
            <button id="nav-toggle" class="flex items-center px-3 py-2 border rounded hover:bg-blue-500 focus:outline-none">
                <svg class="fill-current h-4 md:h-5 w-4 md:w-5" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"/>
                </svg>
            </button>
        </div>
        <!-- nav bar -->
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-4 lg:pt-0" id="nav-content">
            <ul class="text-lg md:text-xl lg:flex justify-end flex-1 items-center text-right">
                <li>
                    <a class="inline-block hover:opacity-75" href="{{ url_for('app.home') }}">Home</a>
                </li>
                <li class="ml-6 xl:ml-12">
                    <a class="inline-block hover:opacity-75" href="{{ url_for('history.history') }}">History</a>
                </li>
                <li class="ml-6 xl:ml-12">
                    <a class="inline-block hover:opacity-75" href="{{ url_for('artist.artist') }}">Artist</a>
                </li>
                {% if current_user.is_authenticated %}
                <li class="ml-6 xl:ml-12">
                    <a class="inline-block hover:opacity-75" href="{{url_for('logout.logout')}}">Logout</a>
                </li>
                <li class="ml-6 xl:ml-12">
                    <a class="inline-block hover:opacity-75" href="{{url_for('user.user')}}">User</a>
                </li>
                {% else %}
                <li class="ml-6 xl:ml-12">
                    <a class="inline-block hover:opacity-75" href="{{url_for('signup.signup')}}">Sign up</a>
                </li>
                <li class="ml-6 xl:ml-12">
                    <a class="inline-block hover:opacity-75" href="{{url_for('login.login')}}">Login</a>
                </li>
                {% endif %}
                <li class="ml-6 xl:ml-12">
                    <a class="inline-block hover:opacity-75" href="{{ url_for('contact.contact') }}">Contact</a>
                </li>
            </ul>
        </div>
    </nav>
</header>

{% for artist in artists %}
<div class="min-h-screen w-screen grid grid-cols-2 flex items-center px-8 md:px-12 xl:px-20 pb-8 pt-8 lg:pb-16 lg:pt-12 gap-8 box" id="{{ artist.name }}">
    <!-- singer -->
    <div class="h-screen lg:h-full col-span-2 lg:col-span-1 shadow-2xl rounded-lg box border-t-2 border-blue-300 p-4 sm:p-6">
        <!-- singer name -->
        <div class="h-1/5 box flex items-center">
            <div class="h-full w-full grid grid-cols-5">
                <div class="h-full col-span-1 flex items-center box lg:p-2">
                    <img src="{{ url_for('static', filename=artist.artist_picture_path) }}" class="w-full rounded-full border-solid border-2 sm:border-4 border-blue-500">
                </div>
                <div class="h-full col-span-4 flex items-center box">
                    <div class="flex flex-wrap pl-2 sm:pl-4 2xl:pl-8 box">
                        <h3 class="text-xl sm:text-3xl md:text-4xl lg:text-3xl xl:text-4xl 2xl:text-5xl font-semibold">
                            {{ artist.name }}
                        </h3>
                        <h3 class="ml-2 text-xl sm:text-3xl md:text-4xl lg:text-3xl xl:text-4xl 2xl:text-5xl font-semibold">
                            <span>{{ artist.name_j }}</span>
                        </h3>
                    </div>
                </div>       
            </div>
        </div>
        <!-- singer desc -->
        <div class="h-1/5 flex items-center px-2 box">
            <p class="text-sm sm:text-base 2xl:text-xl">
                {{ artist.artist_info }}
            </p>
        </div>
        <!-- comments -->
        <div class="h-2/5 flex items-center px-2 box">
            <div class="h-full w-full overflow-scroll">
                <div class="h-1/2 sm:h-1/3 box">         
                    {% set isCommented = {'isCommented':False} %}
                    {% for comment in comments %}      
                        {% if artist.id == comment.to_artist_id %}
                        <div class="h-full w-full grid grid-cols-9 box overflow-scroll">
                            {% for user in users %}
                            {% if comment.from_user_id == user.id %}
                            <div class="h-full col-span-2 sm:col-span-1 flex items-center p-0 xl:p-1">
                                {% if user.picture_path %}
                                <img src="{{ url_for('static', filename=user.picture_path) }}" class="rounded-full border-solid border-2 md:border-4 border-blue-500">
                                {% else %}
                                <img src="/static/image/logoa.jpg" class="rounded-full border-solid border-2 md:border-4 border-blue-500">
                                {% endif %}                                
                            </div>
                            <div class="h-full col-span-7 sm:col-span-8 flex items-center">
                                <div class="w-full h-auto sm:h-5/6 mx-2 sm:mx-4 2xl:mx-8 py-2 px-4 2xl:px-6 bg-white rounded shadow text-blue-400">
                                    <p class="text-xs sm:text-sm lg:text-xs xl:text-sm 2xl:text-lg font-semibold">
                                        @{{ user.username}}
                                    </p>
                                    <p class="text-xs sm:text-sm lg:text-xs xl:text-sm 2xl:text-base">{{ comment.comment }}</p>
                                </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>                        
                        {% if isCommented.update({'isCommented':True}) %}{% endif %}
                        {% endif %}
                    {% endfor %}

                    {% if not isCommented.isCommented %}                
                    <h2>There's no comment yet.</h2>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- add comment -->
        <div class="h-1/5 flex items-center px-2 box">
            <div class="h-full w-full grid grid-cols-9 box">
                {% if current_user.is_authenticated %}
                <div class="h-full col-span-2 sm:col-span-1 flex items-center p-0 xl:p-1">
                    {% if current_user.picture_path %}
                    <img src="{{ url_for('static', filename=current_user.picture_path) }}" class="rounded-full border-solid border-2 md:border-4 border-blue-500">
                    {% else %}
                    <img src="/static/image/logoa.jpg" class="rounded-full border-solid border-2 md:border-4 border-blue-500">
                    {% endif %}
                </div>
                <div class="h-full col-span-7 sm:col-span-8 flex items-center">
                    <form method="POST" class="w-full mx-2 sm:mx-4 2xl:mx-8">
                        {{form_c.csrf_token}}
                        {{ form_c.to_artist_id(value=artist.id) }}
                        <h4 class="text-base sm:text-lg 2xl:text-xl">
                            {{render_field(form_c.comment, rows="2", class="w-full text-gray-400 rounded shadow p-1 px-2 mt-1")}}
                        </h4>
                        <h4 class="text-sm sm:text-lg 2xl:text-xl mt-1 sm:mt-2">
                            {{form_c.submit(class="bg-blue-400 hover:bg-blue-500 rounded-full outline-none py-2 px-4")}}
                        </h4>
                    </form>
                </div>
                {% else %}
                <div class="h-full col-span-1 flex items-center p-0 xl:p-1">
                    <img src="/static/image/logoa.jpg" class="rounded-full border-solid  border-2 xl:border-4 border-blue-500">
                </div>
                <div class="h-full col-span-8 flex items-center flex items-center">
                    <div class="w-full mx-2 sm:mx-4 2xl:mx-8">
                        <h4>You can add comment after you sign up!</h4>
                    </div>
                </div>
                {% endif %}                
            </div>
        </div>
    </div>

    <!-- song -->
    <div class="h-screen lg:h-full col-span-2 lg:col-span-1 shadow-2xl rounded-lg box border-t-2 border-blue-300 p-4 sm:p-6">
        <!-- song title -->
        <div class="h-1/5 box flex items-center">
            <div class="h-full w-full grid grid-cols-5">
                <div class="h-full col-span-1 flex items-center lg:p-2 box">
                    <img src="{{ url_for('static', filename=artist.song_picture_path) }}" alt="" class="w-full shadow">
                </div>
                <div class="h-full col-span-4 flex items-center box">
                    <div class="pl-2 sm:pl-4 2xl:pl-8 box">
                        <h4 class="text-lg sm:text-2xl lg:text-xl xl:text-2xl 2xl:text-4xl"><i class="fas fa-compact-disc mr-2"></i>{{ artist.year }}</h4>
                        <div class="flex flex-wrap sm:flex-nowrap">
                            <h4 class="text-base sm:text-2xl lg:text-xl xl:text-2xl 2xl:text-4xl mt-0 sm:mt-2">
                                {{ artist.title }}
                            </h4>
                            <h4 class="ml-2 text-base sm:text-2xl lg:text-xl xl:text-2xl 2xl:text-4xl mt-0 sm:mt-2">
                                <span>{{ artist.title_j }}</span>
                            </h4>
                        </div>

                        {% if current_user.is_authenticated %}
                        <form method="POST" class="mt-2">
                            {{ form.csrf_token }}
                            {{ form.from_user_id(value=current_user.id) }}
                            {{ form.to_artist_id(value=artist.id) }}

                            {% set isLiked = {'isLiked':False} %}
                            {% for like_song in like_songs %}
                                {% if like_song.from_user_id == current_user.id and like_song.to_artist_id == artist.id %}
                                <h5 class="text-sm sm:text-base xl:text-xl">
                                    {{ form.submit(value="♥ Liked", class="btn-pink") }}
                                </h5>                                    
                                {% if isLiked.update({'isLiked':True}) %}{% endif %}
                                {% endif %}
                            {% endfor %}
                            {% if not isLiked.isLiked %}  
                                <h5 class="text-sm sm:text-base xl:text-xl">
                                    {{ form.submit(class="btn-transparent") }}
                                </h5>
                            {% endif %}
                        </form>
                        {% else %}
                        <h5 class="text-sm sm:text-base xl:text-xl">
                            <a href="{{ url_for('signup.signup') }}">
                                <button class="btn-blue">
                                    ♡ You can save your favorites after you sign up!
                                </button>
                            </a>
                        </h5>
                        {% endif %}

                    </div>
                </div>
            </div>
        </div>
        <!-- song youtube -->
        <div class="h-2/5 sm:h-3/5 lg:h-2/5 xl:h-3/5 flex items-center lg:p-2 mt-0 md:pt-8 box">
            <iframe class="w-full h-full shadow rounded-lg" src="{{ artist.youtube }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <!-- song desc -->
        <div class="h-2/5 sm:h-1/5 lg:h-2/5 xl:h-1/5 flex items-center px-2 box">
            <p class="text-base 2xl:text-xl">
                {{ artist.song_info }}
            </p>
        </div>
    </div>
</div>

{% endfor %}
{% endblock %}